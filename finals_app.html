<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GOATS2 - Final</title>
    <!-- React z CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/javascript">
      const { useState, useEffect } = React;

      const GOOGLE_SHEET_CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHw8kX-ehVxqRrBxKQRAH9EySHdQUfPwWEae-llcCwEp-ba7-Oh82Llo-8rHCszQFJiKC7SZt8KaVg/pub?gid=1242680440&single=true&output=csv";

      function App() {
        const [data, setData] = useState([]);

        const fetchData = async () => {
          try {
            const response = await fetch(GOOGLE_SHEET_CSV_URL);
            const text = await response.text();
            const parsed = Papa.parse(text).data;
            const filtered = parsed
              .slice(40, 59) // Wiersze 41-59
              .map((row) => row.slice(0, 11)); // Kolumny A-K
            setData(filtered);
          } catch (error) {
            console.error("Error fetching data:", error);
          }
        };

        useEffect(() => {
          fetchData();
          const interval = setInterval(fetchData, 3 * 60 * 1000);
          return () => clearInterval(interval);
        }, []);

        return React.createElement(
          "div",
          { style: { padding: "20px" } },
          React.createElement("h1", null, "Tabela z Arkusza Google"),
          React.createElement(
            "button",
            { onClick: fetchData, style: { marginBottom: "10px" } },
            "Odśwież dane"
          ),
          React.createElement(
            "table",
            { border: "1", cellPadding: "5", style: { borderCollapse: "collapse", width: "100%" } },
            React.createElement(
              "tbody",
              null,
              data.map((row, rowIndex) =>
                React.createElement(
                  "tr",
                  { key: rowIndex },
                  row.map((cell, colIndex) =>
                    React.createElement(
                      "td",
                      {
                        key: colIndex,
                        style: {
                          backgroundColor:
                            rowIndex === 0
                              ? "#E0E0E0"
                              : colIndex === 0
                              ? "#F8F8F8"
                              : cell.includes("VS")
                              ? "#FDE2E2"
                              : "white",
                        },
                      },
                      cell
                    )
                  )
                )
              )
            )
          )
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(
        React.createElement(App)
      );
    </script>
  </body>
</html>
