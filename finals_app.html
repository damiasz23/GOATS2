<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Turniej Koszykówki – Faza Pucharowa</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #fafafa; }
    button#refresh { margin-bottom: 10px; padding: 6px 12px; font-size: 1rem; }
    h1 { text-align: center; font-size: 2rem; margin-bottom: 20px; }
    .court-container { display: flex; justify-content: space-between; margin-bottom: 30px; }
    .court { width: 48%; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    table th, table td { border: 1px solid #ccc; padding: 6px; text-align: center; font-size: 0.9rem; }
    table th { background: #ddd; }
    .phase-row { background: #ccc; font-weight: bold; }
    .women-row { background: rgba(255,182,193,0.3); }
    .men-row   { background: rgba(173,216,230,0.3); }
    /* lekkie poszerzenie komórki „Wynik” dla czytelności */
    td.result-cell { min-width: 50px; }
  </style>
</head>
<body>

  <button id="refresh">Odśwież</button>
  <h1>Faza Pucharowa</h1>

  <div id="app">
    <!-- Tutaj wygeneruje się tabela „Boisko A” i „Boisko B” -->
  </div>

<script>
  // ↓  Uwaga: wrzuć tu swój poprawny link do CSV (plik „Terminarz_USTALENIA”, kolumny E i K):
  const CSV_URL =
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHw8kX-ehVxqRrBxKQRAH9EySHdQUfPwWEae-llcCwEp-ba7-Oh82Llo-8rHCszQFJiKC7SZt8KaVg'
    + '/pub?gid=1242680440&single=true&output=csv';

  // Lista placeholderów, w kolejności w jakiej mają się pojawiać w arkuszu:
  //  - „1A vs 2B” (Półfinał Kobiet na Boisko A)
  //  - „1A vs 2B” (Półfinał Mężczyzn na Boisko A)
  //  - „4A vs 4B”  (O 7 miejsce)
  //  - „3A vs 3B”  (O 5 miejsce)
  //  - „1A/2B vs 1B/2A” (O 3 miejsce)
  //  - „1A vs 2B” (Finał Kobiet)
  //  - „1A vs 2B” (Finał Mężczyzn)
  //
  // Analogicznie dla Boisko B:
  //  - „1B vs 2A” (Półfinał Kobiet na Boisko B)
  //  - „1B vs 2A” (Półfinał Mężczyzn na Boisko B)
  //  - „3A vs 3B” (O 5 miejsce)
  //  - „1A/2B vs 1B/2A” (O 3 miejsce)
  //  - brak finałów na boisku B (tam zawsze „PRZERWA TECHNICZNA” – więc zostawiamy puste)
  const PHASES_A = [
    { phase: 'Półfinał Kobiet',   placeholderA: '1A',    placeholderB: '2B' },
    { phase: 'Półfinał Mężczyzn', placeholderA: '1A',    placeholderB: '2B' },
    { phase: 'O 7 miejsc ę',      placeholderA: '4A',    placeholderB: '4B' },
    { phase: 'O 5 miejsc ę',      placeholderA: '3A',    placeholderB: '3B' },
    { phase: 'O 3 miejsc ę',      placeholderA: '1A/2B', placeholderB: '1B/2A' },
    { phase: 'Finał Kobiet',      placeholderA: '1A',    placeholderB: '2B' },
    { phase: 'Finał Mężczyzn',    placeholderA: '1A',    placeholderB: '2B' }
  ];
  const PHASES_B = [
    { phase: 'Półfinał Kobiet',   placeholderA: '1B',    placeholderB: '2A' },
    { phase: 'Półfinał Mężczyzn', placeholderA: '1B',    placeholderB: '2A' },
    { phase: 'O 7 miejsc ę',      placeholderA: '',      placeholderB: ''   }, // tu puste bo na boisku B brak „O 7 miejsc ę”
    { phase: 'O 5 miejsc ę',      placeholderA: '3A',    placeholderB: '3B' },
    { phase: 'O 3 miejsc ę',      placeholderA: '1A/2B', placeholderB: '1B/2A' },
    { phase: 'Finał Kobiet',      placeholderA: '',      placeholderB: ''   }, // brak finałów na boisku B
    { phase: 'Finał Mężczyzn',    placeholderA: '',      placeholderB: ''   }
  ];

  // Struktura surowych wyników: po fetchowaniu otrzymamy listę
  // { teamA: '1A', teamB: '2B', rawA: '24:26' } albo { teamA: '1B', teamB: '2A', rawB: '33:23' }, itd.
  async function fetchPlayoffResults() {
    try {
      const res = await fetch(CSV_URL);
      const text = await res.text();
      const lines = text.trim().split(/\r?\n/).slice(1);
      const output = [];

      lines.forEach(line => {
        // Rozdzielamy po przecinku lub średniku, usuwamy cudzysłowy:
        const cols = line.split(/,|;/)
                         .map(c => c.replace(/^"|"$/g, '').trim());

        // Kolumny E i K (indeksy od 0):
        // E = cols[4], odpowiada wpisowi „Półfinał Kobiet/ Mężczyzn / O 7 miejsc / …” w Boisko A
        // K = cols[10], analogicznie w Boisko B
        const teamA = cols[1],   teamB = cols[3],   rawA = cols[4];
        const teamC = cols[7],   teamD = cols[9],   rawB = cols[10];

        // Dodajemy tylko, jeśli faktycznie coś jest wpisane, a nie „:” albo „”:
        if (rawA && rawA !== ':') output.push({ teamA, teamB, rawScore: rawA });
        if (rawB && rawB !== ':') output.push({ teamA: teamC, teamB: teamD, rawScore: rawB });
      });

      return output;
    } catch (err) {
      console.error(err);
      return [];
    }
  }

  // Teraz generujemy tabelę „Boisko A” i „Boisko B”, wstawiając wyniki do odpowiednich wierszy:
  async function renderPlayoffs() {
    const all = document.getElementById('app');
    all.innerHTML = 'Ładowanie wyników fazy pucharowej…';

    // 1) Pobieramy surowe wyniki:
    const results = await fetchPlayoffResults();
    //    results np. = [
    //       { teamA: '1A', teamB: '2B', rawScore: '24:26' }, 
    //       { teamA: '1B', teamB: '2A', rawScore: '33:23' },
    //       { teamA: '1A', teamB: '2B', rawScore: '32:44' },
    //       { teamA: '1B', teamB: '2A', rawScore: '44:33' },
    //       ... (reszta „:” pomijamy)
    //    ]
    //
    // 2) Budujemy tabelę „Boisko A” i „Boisko B” w kodzie HTML:

    // Pomocniczna funkcja: dla danej pary (pa, pb) wyszukaj w „results” odpowiadający rawScore:
    function findScore(pa, pb) {
      const rec = results.find(r => (r.teamA === pa && r.teamB === pb) || (r.teamA === pb && r.teamB === pa));
      if (!rec) return ''; 
      const [x,y] = rec.rawScore.split(':');
      // Jeśli wiersz `pa vs pb`, to jeśli pa jest r.teamA, pokaz „x:y”, w przeciwnym wypadku odwróć „y:x”
      return (rec.teamA === pa) ? `${x}:${y}` : `${y}:${x}`;
    }

    // 3) Generujemy HTML:

    // Sekcja Boisko A
    let htmlA = '<div class="court"><table><thead>' +
                '<tr><th>Godz.</th><th>Faza</th><th>Zespół A</th><th></th><th>Zespół B</th><th>Wynik</th></tr>' +
                '</thead><tbody>';
    const timesA = ['12:30-13:20','13:20-14:10','14:10-15:00','15:00-15:50','15:50-16:40','17:00-17:50','17:50-18:40'];
    for (let i = 0; i < PHASES_A.length; i++) {
      const p = PHASES_A[i];
      // Ustalamy klasę wiersza (kobiety / mężczyźni):
      const cls = (i === 0 || i === 2 || i === 4 || i === 5) ? 'women-row' : 'men-row';
      htmlA += `<tr class="${cls}">` +
               `<td>${timesA[i]}</td>` +
               `<td>${p.phase}</td>` +
               `<td>${p.placeholderA}</td>` +
               `<td>vs</td>` +
               `<td>${p.placeholderB}</td>` +
               `<td class="result-cell">${findScore(p.placeholderA, p.placeholderB)}</td>` +
               `</tr>`;
    }
    htmlA += '</tbody></table></div>';

    // Sekcja Boisko B
    let htmlB = '<div class="court"><table><thead>' +
                '<tr><th>Godz.</th><th>Faza</th><th>Zespół A</th><th></th><th>Zespół B</th><th>Wynik</th></tr>' +
                '</thead><tbody>';
    const timesB = ['12:30-13:20','13:20-14:10','14:10-15:00','15:00-15:50','15:50-16:40','17:00-17:50','17:50-18:40'];
    for (let i = 0; i < PHASES_B.length; i++) {
      const p = PHASES_B[i];
      const cls = (i === 0 || i === 2 || i === 4 || i === 5) ? 'women-row' : 'men-row';
      htmlB += `<tr class="${cls}">` +
               `<td>${timesB[i]}</td>` +
               `<td>${p.phase}</td>` +
               `<td>${p.placeholderA}</td>` +
               `<td>vs</td>` +
               `<td>${p.placeholderB}</td>` +
               `<td class="result-cell">${findScore(p.placeholderA, p.placeholderB)}</td>` +
               `</tr>`;
    }
    htmlB += '</tbody></table></div>';

    // Łączymy A i B w kontenerze „court-container”:
    all.innerHTML = `<div class="court-container">${htmlA}${htmlB}</div>`;
  }

  // Obsługa przycisku „Odśwież”:
  document.getElementById('refresh').addEventListener('click', () => {
    renderPlayoffs();
  });

  // Automatyczne odświeżanie co 3 minuty (180 000 ms):
  setInterval(renderPlayoffs, 180000);

  // Na starcie ładowanie:
  renderPlayoffs();

</script>
</body>
</html>
