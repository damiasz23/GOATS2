// Instalacja dependencies:
// npm install react react-dom papaparse

import React, { useEffect, useState } from "react";
import Papa from "papaparse";

const GOOGLE_SHEET_CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHw8kX-ehVxqRrBxKQRAH9EySHdQUfPwWEae-llcCwEp-ba7-Oh82Llo-8rHCszQFJiKC7SZt8KaVg/pub?gid=1242680440&single=true&output=csv";

export default function App() {
  const [data, setData] = useState([]);

  const fetchData = async () => {
    try {
      const response = await fetch(GOOGLE_SHEET_CSV_URL);
      const text = await response.text();
      const parsed = Papa.parse(text).data;

      // Filtrujemy wiersze 41-59 i kolumny A-K
      const filtered = parsed
        .slice(40, 59) // Wiersze 41-59 (0-indeksowane)
        .map(row => row.slice(0, 11)); // Kolumny A-K (0-indeksowane)

      setData(filtered);
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  };

  useEffect(() => {
    fetchData();
    const interval = setInterval(fetchData, 3 * 60 * 1000);
    return () => clearInterval(interval);
  }, []);

  const refreshData = () => fetchData();

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Tabela z Arkusza Google</h1>
      <button
        onClick={refreshData}
        className="mb-4 p-2 bg-blue-500 text-white rounded"
      >
        Odśwież dane
      </button>
      <div className="overflow-auto border">
        <table className="border-collapse w-full">
          <tbody>
            {data.map((row, rowIndex) => (
              <tr key={rowIndex}>
                {row.map((cell, colIndex) => (
                  <td
                    key={colIndex}
                    className="border p-2"
                    style={{
                      backgroundColor: getBackgroundColor(rowIndex, colIndex),
                    }}
                  >
                    {cell}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );

  function getBackgroundColor(rowIndex, colIndex) {
    if (rowIndex === 0) return "#E0E0E0"; // Nagłówki
    if (colIndex === 0) return "#F8F8F8"; // Pierwsza kolumna
    if (data[rowIndex] && data[rowIndex][colIndex]?.includes("VS"))
      return "#FDE2E2"; // Mecz
    return "white";
  }
}
