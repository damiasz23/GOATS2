<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finał turnieju Goats 2</title>

  <!-- PapaParse (do wczytywania CSV) -->
  <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>

  <style>
    /* ======================= */
    /*    OGÓLNE STYLINY       */
    /* ======================= */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: url('Goats2.png') no-repeat center center fixed;
      background-size: cover;
    }
    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }
    button {
      display: block;
      margin: 0 auto 20px;
      padding: 8px 16px;
      font-size: 1rem;
      background-color: #2c3e50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1a242f;
    }

    /* ======================= */
    /*  UKŁAD TABEL OBOK SIEBIE */
    /* ======================= */
    .tables-row {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      flex-wrap: wrap;
    }
    .table-wrapper {
      width: 48%;
      background-color: #fafafa;
      border: 1px solid #ccc;
      border-radius: 6px;
      overflow: hidden;
    }
    .court-label {
      background-color: #e5e5e5;
      text-align: center;
      font-weight: 600;
      padding: 10px 0;
      font-size: 1.1rem;
      text-transform: uppercase;
    }

    /* ======================= */
    /*   STYL SAMEJ TABELI    */
    /* ======================= */
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: center;
      font-size: 0.95rem;
    }
    th {
      background-color: #e5e5e5;
      font-weight: 600;
    }
    /* Wiersz‐nagłówek sekcji (np. „PÓŁFINAŁ KOBIET”, „O 7 MIEJSCE” itd.) */
    .section-header {
      background-color: #d0d0d0;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 1rem;
    }

    /* ======================= */
    /*  KOLORY WIERSZY MECZOWYCH */
    /* ======================= */
    .pink  { background-color: #fde2e2; }
    .blue  { background-color: #dce9f9; }
    .gray  { background-color: #e5e5e5; }

    /* ======================= */
    /*    TABELA „Finały”      */
    /* ======================= */
    .final-wrapper {
      margin-top: 30px;
      background-color: #fafafa;
      border: 1px solid #ccc;
      border-radius: 6px;
      overflow: hidden;
    }
    .final-label {
      text-align: center;
      font-weight: 600;
      background-color: #e5e5e5;
      padding: 10px 0;
      font-size: 1.1rem;
      text-transform: uppercase;
    }

    /* ======================= */
    /*    RESPONSYWNOŚĆ        */
    /* ======================= */
    @media (max-width: 800px) {
      .table-wrapper {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <button onclick="fetchData()">Odśwież dane</button>
    <h1>Finał turnieju Goats 2</h1>

    <!-- Dwie tabele obok siebie: Boisko A i Boisko B -->
    <div class="tables-row">
      <div class="table-wrapper">
        <div class="court-label">Boisko A</div>
        <table id="courtA"></table>
      </div>
      <div class="table-wrapper">
        <div class="court-label">Boisko B</div>
        <table id="courtB"></table>
      </div>
    </div>

    <!-- Pod spodem tabela Finałów (pełna szerokość) -->
    <div class="final-wrapper">
      <div class="final-label">Finały</div>
      <table id="final"></table>
    </div>
  </div>

  <script>
    // ===================================================================
    // 1) ADRES CSV – Twój arkusz z fazą finałową w formacie CSV
    // ===================================================================
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRHw8kX-ehVxqRrBxKQRAH9EySHdQUfPwWEae-llcCwEp-ba7-Oh82Llo-8rHCszQFJiKC7SZt8KaVg/pub?gid=1242680440&single=true&output=csv';

    // ===================================================================
    // 2) getClass(rowIndex) – przydziela kolor tła wierszowi MECZOWEMU
    //    (dokładnie tak, jak w Twoich poprzednich klasach pink/blue/gray)
    // ===================================================================
    function getClass(rowIndex) {
      const pinkRows =  [1, 5, 7, 14];
      const blueRows =  [3, 4, 5, 6, 15];
      const grayRows =  [0, 2, 8, 13, 16];
      if (pinkRows.includes(rowIndex)) return 'pink';
      if (blueRows.includes(rowIndex)) return 'blue';
      if (grayRows.includes(rowIndex)) return 'gray';
      return '';
    }

    // ===================================================================
    // 3) fetchData() – pobiera CSV, wybiera wiersze 40..58 i wysyła do draw()
    // ===================================================================
    async function fetchData() {
      try {
        const res = await fetch(CSV_URL);
        const text = await res.text();
        const parsed = Papa.parse(text.trim()).data;
        // Zakładamy, że właśnie wiersze 40..58 (łącznie 19 wierszy) to pełna faza finałowa
        const filtered = parsed.slice(40, 59).map(row => row.slice(0, 11));
        renderAllTables(filtered);
      } catch (err) {
        console.error('Błąd podczas pobierania CSV:', err);
      }
    }

    // ===================================================================
    // 4) renderAllTables(data) – dzieli dane na trzy fragmenty: 
    //    • CourtA  (kolumny 0..5) 
    //    • CourtB  (kolumny 6..10) 
    //    • Finały  (od wiersza, w którym pojawi się „FINAŁ KOBIET”)
    // ===================================================================
    function renderAllTables(data) {
      // 4.1) Oddzielamy dane na dwie części – CourtA i CourtB
      const courtA = data.map(r => r.slice(0, 6));   // 6 kolumn: [0]=Sekcja lub godzina, [1]=drużyna A, [2]=VS, [3]=drużyna B, [4]=wynik lub ":", [5]=zwykle puste
      const courtB = data.map(r => r.slice(6, 11));  // 5 wartości: [0]=Sekcja lub godzina, [1]=drużyna, [2]=VS, [3]=drużyna, [4]=wynik lub ":", [5] – tu nie ma, więc undefined

      // 4.2) Lokalizujemy wiersz, od którego zaczyna się sekcja Finałów
      //     Szukamy pierwszego wiersza, w którym w kolumnie A (czyli data[i][0]) jest napis „FINAŁ” (albo „Finał”).
      let finalStartIdx = data.findIndex(r => 
        r[0] && r[0].toString().toUpperCase().includes("FINAŁ")
      );
      if (finalStartIdx === -1) {
        // Jeżeli nie znaleziono, to po prostu rysujemy CourtA i CourtB, a finały zostawiamy puste.
        finalStartIdx = data.length;
      }

      // 4.3) Oddzielamy „dane finałowe” – weź wiersze od finalStartIdx do końca
      const finalsData = data.slice(finalStartIdx).map(r => r.slice(0, 6));

      // 4.4) Wypełniamy HTML-owe <table> trzema fragmentami:
      document.getElementById('courtA').innerHTML = buildCourtTable(courtA);
      document.getElementById('courtB').innerHTML = buildCourtTable(courtB);
      document.getElementById('final').innerHTML  = buildFinalTable(finalsData);
    }

    // ===================================================================
    // 5) buildCourtTable(rows) – buduje tabelę dla jednego boiska (A lub B).
    //    rows to cała tablica wierszy (np. 19 wierszy), przekrojonych do 6 kolumn.
    //    Dla każdego wiersza:
    //     – jeżeli r[0] != "" i r[1] == "" → to jest nagłówek sekcji (np. "PÓŁFINAŁ KOBIET" lub "O 7 MIEJSCE" lub "PRZERWA TECHNICZNA").
    //     – jeżeli cały r jest pusty → pomiń wiersz.
    //     – w przeciwnym razie → wiersz meczowy: wyświetl r[0]..r[4] w `<td>`, nadając klasę kolorystyczną getClass(i).
    // ===================================================================
    function buildCourtTable(rows) {
      let html = "";
      for (let i = 0; i < rows.length; i++) {
        const r = rows[i].map(cell => (cell === undefined ? "" : cell)); 
        const allEmpty = r.every(cell => cell.toString().trim() === "");
        if (allEmpty) {
          // pomiń całkowicie pusty wiersz
          continue;
        }

        const first = r[0].toString().trim();
        const second = r[1].toString().trim();

        // 5.1) Jeżeli w pierwszej komórce jest jakiś tekst, a w drugiej jest pustka → traktuj jako nagłówek sekcji
        if (first !== "" && second === "") {
          html += `
            <tr class="section-header">
              <th colspan="${r.length}">${first}</th>
            </tr>`;
          continue;
        }

        // 5.2) W przeciwnym razie to wiersz meczowy – wyświetl tyle komórek, ile jest w tym wierszu (zwykle 5 lub 6)
        //      Nadajemy klasę kolorystyczną według indeksu i (getClass(i)).
        const cssClass = getClass(i);
        html += `<tr class="${cssClass}">`;
        // Wyświetl od 0 do 4. kolumny jako: godzina, drużyna A, VS, drużyna B, wynik
        // Jeśli jest szósta (r[5]) – też dodaj jako pustą komórkę, żeby wyrównać kolumny.
        for (let col = 0; col < r.length; col++) {
          html += `<td>${r[col] || ""}</td>`;
        }
        html += "</tr>";
      }
      return html;
    }

    // ===================================================================
    // 6) buildFinalTable(rows) – buduje tabelę „Finały” na podstawie przekazanych wierszy.
    //    rows to tablica podzbioru data.slice(finalStartIdx). Dla każdego wiersza:
    //     – jeżeli r[0] nie jest pusty, a r[1] == "" → nagłówek sekcji (np. "FINAŁ KOBIET" czy "FINAŁ MĘŻCZYZN").
    //     – jeżeli r jest pusty → pomiń wiersz.
    //     – w przeciwnym razie → wiersz meczowy (wyświetlamy kolumny 0..4).
    // ===================================================================
    function buildFinalTable(rows) {
      let html = "";
      for (let i = 0; i < rows.length; i++) {
        const r = rows[i].map(cell => (cell === undefined ? "" : cell));
        const allEmpty = r.every(cell => cell.toString().trim() === "");
        if (allEmpty) {
          continue; // pomiń całkowicie pusty wiersz
        }

        const first = r[0].toString().trim();
        const second = r[1].toString().trim();

        // 6.1) Jeżeli nagłówek sekcji (np. "FINAŁ KOBIET"), to <tr class="section-header"><th colspan>..</th></tr>
        if (first !== "" && second === "") {
          html += `
            <tr class="section-header">
              <th colspan="6">${first}</th>
            </tr>`;
          continue;
        }

        // 6.2) Wiersz meczowy – nadajemy styl kolorystyczny wg indexu wiersza sumarycznie
        const cssClass = getClass(i);
        html += `<tr class="${cssClass}">`;
        // Wyświetlamy tylko kolumny 0..4 (czas, drużyna A, VS, drużyna B, wynik).
        for (let col = 0; col < 5; col++) {
          html += `<td>${r[col] || ""}</td>`;
        }
        // Jeśli w CSV są dodatkowe kolumny, można je tu pominąć albo dodać <td>...
        html += `</tr>`;
      }
      return html;
    }

    // ===================================================================
    // 7) Na starcie ładujemy dane
    // ===================================================================
    fetchData();
  </script>
</body>
</html>
